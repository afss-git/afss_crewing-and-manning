// Prisma schema for crew-manning
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}


generator client {
  provider = "prisma-client-js"
}

model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  hash      String
  salt      String
  role      String   @default("admin")
  createdAt DateTime @default(now())
}

model ExternalApiToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model User {
  id         Int        @id @default(autoincrement())
  email      String     @unique
  firstName  String?
  lastName   String?
  approved   Boolean    @default(false)
  documents  Document[]
  shipOwner  ShipOwner?
}

model Document {
  id         Int       @id @default(autoincrement())
  userId     Int
  user       User      @relation(fields: [userId], references: [id])
  docType    String
  status     String
  adminNotes String?
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())
}

model Setting {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String
}

model ShipOwner {
  id                  Int      @id @default(autoincrement())
  userId              Int      @unique
  user                User     @relation(fields: [userId], references: [id])
  companyName         String
  imoNumber           String?
  website             String?
  hqAddress           String
  vesselTypes         String
  fleetSize           String
  primaryTradingArea  String
  contactFullName     String
  contactRole         String
  contactEmail        String
  contactPhone        String
  document1           String?
  document2           String?
  document3           String?
  document4           String?
  contracts           Contract[]
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("ship_owners")
}

model Contract {
  id                   Int              @id @default(autoincrement())
  shipOwnerId          Int
  shipOwner            ShipOwner        @relation(fields: [shipOwnerId], references: [id])
  contractId           String           @unique
  vesselName           String
  vesselImoNumber      String?
  position             String
  positionType         String  // "urgent" | "medical" | "scheduled" | "spot"
  startDate            DateTime
  endDate              DateTime
  duration             String
  requiredCertifications String
  dayRate              String
  status               String @default("open") // "open" | "reviewing" | "assigned" | "completed" | "cancelled"
  clientName           String
  clientCompany        String?
  specificInstructions String?
  positions            ContractPosition[]
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model ContractPosition {
  id                   Int      @id @default(autoincrement())
  contractId           Int
  contract             Contract @relation(fields: [contractId], references: [id])
  position             String
  specifications       String?
  assignedSeafarer     Int?
  status               String @default("open") // "open" | "assigned" | "completed"
  assignedAt           DateTime?
  createdAt            DateTime @default(now())
}
